# Jenkins CI Image Vulnerability Scan
This is a setup to scan built Docker image from vulnerabilities with [CoreOS Clair](https://github.com/coreos/clair) in Jenkins. [Clairctl](https://github.com/jgsqware/clairctl) is used for analysing and making HTML-reports.

## How it works
1. Jenkins builds Docker image.
2. Clairctl script analyses the images layers and creates a HTML-report containing CVE-details.
3. Clairctl script cancels the remaining Jenkins build if Docker image contains too many high severity vulnerabilities.

## What are the files for?
Jenkinsfile generates Clairctl binary with golang:1.8. Clairctl binary is then added to Dockerfile.

Dockerfile builds Docker image with kubectl, Docker binary, Clairctl binary, Clairctl script and configuration file.

Clairctl.yml is a configuration file containing Clair URI. It is used in the script when generating HTML-report.

Clairctl.groovy is a Groovy script where Clairctl generates HTML-report. Jenkins' HTML Publisher Plugin archives it for you to check it.
The script then uses 'if else' statements to check every severity level from vulnerabilities. If there are too many vulnerabilities from certain severity level, the build will be set to failed. 
